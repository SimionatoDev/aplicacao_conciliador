import{a as V,b as R,c as T}from"./chunk-MVAYKZZP.js";import{a as G}from"./chunk-6HOVCJBT.js";import{e as v}from"./chunk-QXQ3G5IP.js";import{a as d,b as h,d as y,e as k,f as D}from"./chunk-P3XNZYJ6.js";import{B as q,E as K,F as J,R as $,S as W,b as L,e as P,f as U,g as I,h as F,i as O,j as w,k as N,l as j,o as B,y as A}from"./chunk-Q7QCMHQW.js";import{m as E,o as b}from"./chunk-33ZGYKW3.js";import"./chunk-CARY4E7O.js";import{$c as x,Hb as s,Ib as t,Jb as g,Qb as c,ac as l,cb as C,da as p,db as r,na as M,oa as u,yb as _}from"./chunk-KCGDNXPD.js";var f=class m{constructor(i,e,o,n,a,X,Y,Z,ee){this.formBuilder=i;this.globalService=e;this.usuariosService=o;this.empresasServices=n;this.localStorageSrv=a;this.loginSrv=X;this.router=Y;this.matDialog=Z;this.appSnackBar=ee;this.formulario=this.formulario=i.group({id:[{value:""}],senha:[{value:""}]})}formulario;empresa=new h;usuario=new d;inscricaoUsuario;inscricaoEmpresa;inscricaoLogin;ngOnInit(){this.setValue()}ngOnDestroy(){this.inscricaoUsuario?.unsubscribe(),this.inscricaoEmpresa?.unsubscribe(),this.inscricaoLogin?.unsubscribe()}setValue(){this.formulario.setValue({id:this.globalService.getUsuario().id==0?"":this.globalService.getUsuario().id,senha:""})}setValueNoParam(){this.formulario.setValue({id:"",senha:""})}getValoresIniciais(){let i=this.localStorageSrv.getString("Token");if(i){let e=this.getPayloadData(i);e&&e.id_empresa&&e.id_usuario&&this.getEmpresa(e.id_empresa,e.id_usuario)}}getEmpresa(i=1,e){this.inscricaoEmpresa=this.empresasServices.getEmpresa(i).subscribe({next:o=>{this.globalService.setEmpresa(o),this.getUsuario(i,e)},error:o=>{this.appSnackBar.openFailureSnackBar(`Problemas Com A Empresa ${v(o)}`,"OK")}})}getUsuario(i,e){this.inscricaoUsuario=this.usuariosService.getUsuario(i,e).subscribe({next:o=>{console.log(o),this.globalService.setUsuario(o),this.globalService.setLogado(!0),this.globalService.getUsuario().trocarsenha=="S"&&this.globalService.setChangePassWord()},error:o=>{this.appSnackBar.openFailureSnackBar(`Problemas Com O Usu\xE1rio ${v(o)}`,"OK"),this.globalService.setUsuario(new d),this.globalService.setLogado(!1)}})}getLogin(i,e,o){let n={id_empresa:i,codigo:e,password:o};this.inscricaoLogin=this.loginSrv.login(n).subscribe({next:a=>{this.localStorageSrv.setString("Token",a.accessToken),this.getEmpresa(a.id_empresa,a.id)},error:a=>{this.appSnackBar.openFailureSnackBar("Problemas Com O Login","OK")}})}onValidar(){let i=this.formulario.value.id,e=this.formulario.value.senha;this.getLogin(1,i,e)}onCancelar(){this.router.navigate(["/"])}onSair(){this.localStorageSrv.clear(),this.globalService.setLogado(!1),this.globalService.setUsuario(new d),this.globalService.setEmpresa(new h),this.router.navigate(["/login"])}onEsqueceu(){}getPayloadData(i){try{let e=i.split(".")[1],o=atob(e),n=JSON.parse(o),a=new V;return a.id_empresa=n.id_empresa,a.id_usuario=n.id_usuario,a}catch(e){return console.error("Erro ao decodificar o token:",e),null}}static \u0275fac=function(e){return new(e||m)(r(w),r(k),r(y),r(G),r(R),r(T),r(E),r(A),r(D))};static \u0275cmp=M({type:m,selectors:[["app-login"]],decls:28,vars:1,consts:[[1,"quadro"],["autocomplete","off",1,"formulario",3,"formGroup"],[1,"linha-login"],["appearance","outline",1,"controle"],["matInput","","formControlName","id"],["matInput","","formControlName","senha","type","password"],[1,"button-container-right"],["mat-raised-button","","color","primary",1,"botao",3,"click"],["mat-raised-button","","color","accent",1,"botao",3,"click"],["mat-button","",1,"green-icon",3,"click"]],template:function(e,o){e&1&&(s(0,"div",0)(1,"form",1)(2,"h2"),l(3,"Bem Vindo Ao Conciliador"),t(),s(4,"h3"),l(5,"Identifique-se Por Favor"),t(),s(6,"div",2)(7,"mat-form-field",3)(8,"mat-label"),l(9,"USU\xC1RIO"),t(),g(10,"input",4),t()(),s(11,"div",2)(12,"mat-form-field",3)(13,"mat-label"),l(14,"Senha"),t(),g(15,"input",5),t()(),s(16,"div",6)(17,"button",7),c("click",function(){return o.onValidar()}),l(18," Login "),t(),s(19,"button",8),c("click",function(){return o.onCancelar()}),l(20," Cancelar "),t()(),g(21,"br")(22,"br"),s(23,"div",6)(24,"button",9),c("click",function(){return o.onSair()}),l(25,"Sair"),t(),s(26,"button",9),c("click",function(){return o.onEsqueceu()}),l(27," Esqueceu A Senha "),t()()()()),e&2&&(C(),_("formGroup",o.formulario))},dependencies:[B,J,K,q,I,L,P,U,F,O],styles:[".quadro[_ngcontent-%COMP%]{width:50%;margin:50px auto;border:2px solid black;box-shadow:10px 10px 5px 6px gray}.formulario[_ngcontent-%COMP%]{margin:10px 10px 10px 30px;align-items:center}h2[_ngcontent-%COMP%]{text-align:center;align-items:center;margin-top:20px;margin-bottom:10px;color:#00f}h3[_ngcontent-%COMP%]{text-align:center;align-items:center;margin-top:20px;margin-bottom:10px;color:red}.controle[_ngcontent-%COMP%]{width:inherit}.botao[_ngcontent-%COMP%]{min-width:100px;max-width:160px}.button-container-right[_ngcontent-%COMP%]{display:flex;justify-content:right;height:min-content;width:100%}.button-container-right[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:10px}"]})};var Q=[{path:"",redirectTo:"login",pathMatch:"full"},{path:"login",component:f}],S=class m{static \u0275fac=function(e){return new(e||m)};static \u0275mod=u({type:m});static \u0275inj=p({imports:[b.forChild(Q),b]})};var H=class m{static \u0275fac=function(e){return new(e||m)};static \u0275mod=u({type:m});static \u0275inj=p({imports:[x,S,$,N,j,W]})};export{H as LoginModule};
