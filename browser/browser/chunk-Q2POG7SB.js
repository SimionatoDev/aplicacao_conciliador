import{a as F}from"./chunk-5NBA5GWV.js";import"./chunk-BYXBJQAS.js";import{a as xt}from"./chunk-APDG2UCO.js";import{c as W,e as Q,f as st}from"./chunk-P3XNZYJ6.js";import{B as ct,D as dt,E as ut,F as ft,G as ht,H as _t,I as gt,J as vt,R as bt,S as St,b as X,e as Z,f as J,g as Y,h as tt,i as et,j as it,k as ot,l as at,o as rt,p as nt,s as lt,t as mt,u as pt}from"./chunk-Q7QCMHQW.js";import{a as $,b as H,c as z,m as K,o as U}from"./chunk-33ZGYKW3.js";import"./chunk-CARY4E7O.js";import{$c as G,Hb as a,Ib as r,Jb as L,Nb as O,Qb as _,Sb as b,Xc as D,Yc as j,ac as n,ca as T,cb as l,cc as u,d as w,da as x,db as g,e as I,ha as V,lc as N,mc as R,na as B,oa as C,ub as v,wa as f,xa as h,yb as d}from"./chunk-KCGDNXPD.js";var P=class{id_empresa=0;id=0;codemp=0;numpro=0;cod_cli_sim="";datini="";id_contrato=0;status_conciliador="";status_arquivos="";status_assinatura="";pagina=0;tamPagina=50;contador="N";orderby="";sharp=!1};var q=class{index=0;arquivos=[];constructor(e,t){this.index=e,this.arquivos=t}};var M=class{arquivo=null;nome="";constructor(e,t){this.nome=e,this.arquivo=t}};var E=class o{constructor(e){this.http=e}apiURL=W.apiURL;getSim_HistoricosParametro_01Arquivos(e){let t=new URL("importacaosim/sim_historicos_Arquivos",this.apiURL).toString();return this.http.post(t,e)}uploadSim(e,t){console.log("Service - upload Sim-Doc:",t);let i=new FormData;i.append("id_histo",e.toString()),t.forEach(p=>{i.append("files",p)});let s=new URL("importacaosim/load_file_sim",this.apiURL).toString(),m=new $("POST",s,i,{reportProgress:!0,responseType:"json"});return this.http.request(m)}static \u0275fac=function(t){return new(t||o)(V(z))};static \u0275prov=T({token:o,factory:o.\u0275fac,providedIn:"root"})};function qt(o,e){if(o&1&&(a(0,"tr")(1,"td")(2,"div",22)(3,"mat-label",17),n(4),r()()()()),o&2){let t=e.$implicit;l(4),u("",t.nome," ")}}function Mt(o,e){if(o&1&&(a(0,"table",13)(1,"tr",14)(2,"th"),n(3,"Arquivo"),r()(),v(4,qt,5,1,"tr",15),r()),o&2){let t=b(2).$implicit;l(4),d("ngForOf",t.lsArquivos.arquivos)}}function Et(o,e){if(o&1){let t=O();a(0,"div")(1,"mat-accordion")(2,"mat-expansion-panel",20),_("opened",function(){f(t);let s=b(3);return h(s.panelOpenState=!0)})("closed",function(){f(t);let s=b(3);return h(s.panelOpenState=!1)}),a(3,"mat-expansion-panel-header")(4,"mat-panel-description"),n(5),r()(),a(6,"div",21),v(7,Mt,5,1,"table",12),r()()()()}if(o&2){let t=b().$implicit;l(5),u("Total De Arquivos: ",t.lsArquivos.arquivos.length," "),l(2),d("ngIf",t.lsArquivos.arquivos.length>0)}}function yt(o,e){if(o&1&&(a(0,"tr")(1,"td")(2,"div",16)(3,"mat-label",17),n(4),N(5,"zeroFill"),r()()(),a(6,"td")(7,"div",16)(8,"mat-label",17),n(9),r()()(),a(10,"td")(11,"div",16)(12,"mat-label",17),n(13),r()()(),a(14,"td")(15,"div",18)(16,"mat-label",17),n(17),r()()(),a(18,"td"),v(19,Et,8,2,"div",19),r(),a(20,"td")(21,"div",16)(22,"mat-label",17),n(23),r()()()()),o&2){let t=e.$implicit,i=e.index;l(4),u("",R(5,6,i+1)," "),l(5),u("",t.codemp," "),l(4),u("",t.tipopro," "),l(4),u("",t.numpro," "),l(2),d("ngIf",t.lsArquivos&&t.lsArquivos.arquivos&&t.lsArquivos.arquivos.length>0),l(4),u("",t.status_upload," ")}}function kt(o,e){if(o&1&&(a(0,"table",13)(1,"tr",14)(2,"th"),n(3,"Seq"),r(),a(4,"th"),n(5,"Empresa"),r(),a(6,"th"),n(7,"Tipo Proposta"),r(),a(8,"th"),n(9,"N\xBA Proposta"),r(),a(10,"th"),n(11,"Qtd Arquivos"),r(),a(12,"th"),n(13,"Status"),r()(),v(14,yt,24,8,"tr",15),r()),o&2){let t=b();l(14),d("ngForOf",t.getHistoFiltrados())}}var y=class o{constructor(e,t,i,s,m){this.globalService=e;this.formBuilder=t;this.SimComplementarSrv=i;this.router=s;this.appSnackBar=m;this.formulario=t.group({caminho:[{value:""}]}),this.setValue()}arquivos=[];arquivosLocais=[];progress=0;formulario;inscricaoSim;controlePaginas=new F(50,0);tamPagina=100;historicos=[];panelOpenState=!1;pastaOk=!1;filtroPasta=!0;isUploading=!1;isCancelando=!1;isFiltroExiste=!1;botoesOn=!1;ngOnInit(){}ngOnDestroy(){this.inscricaoSim?.unsubscribe()}getHistorico(e=2){let t=new P;t.id_empresa=this.globalService.getEmpresa().id,t.codemp=3008,t.numpro=527,t.status_arquivos="X",e==1?t.contador="S":(t.pagina=this.controlePaginas.getPaginalAtual(),t.tamPagina=this.controlePaginas.getTamPagina()),this.inscricaoSim=this.SimComplementarSrv.getSim_HistoricosParametro_01Arquivos(t).subscribe({next:i=>{if(e==2){this.historicos=i,console.log(this.historicos);let s=0;this.arquivos=[],this.historicos.forEach(m=>{let p=this.arquivosLocais.filter(S=>{let Ft=`${m.codemp}-${m.numpro}`;return S.name.startsWith(Ft)}),c=[];p.forEach(S=>{c.push(new M(S.name,S))}),m.lsArquivos=new q(s,c),s++})}else this.controlePaginas=new F(this.tamPagina,i.total==0?1:i.total),this.getHistorico()},error:i=>{this.arquivos=[],this.historicos=[],this.controlePaginas=new F(this.tamPagina,0)}})}onHome(){this.router.navigate([""])}setValue(e=""){this.formulario.setValue({caminho:e})}onFileSelected(e){let t=e.target.files;if(t.length>0){let m=t[0].webkitRelativePath.split("/")[0];console.log("Pasta selecionada:",m)}}onExecucao(){this.onUpload()}onCancelar(){this.isCancelando=!0,this.isUploading||this.onHome()}onUpload(){return w(this,null,function*(){let e=[],t=0;for(let i=0;i<this.getHistoFiltrados().length;i++)if(this.getHistoFiltrados()[i].lsArquivos?.arquivos.length!=0){e=[];for(let s=0;s<this.getHistoFiltrados()[i].lsArquivos.arquivos.length;s++){let p=yield this.getHistoFiltrados()[i].lsArquivos.arquivos[s].arquivo.getFile();e.push(p)}e.length>0&&(yield this.UploadFile(1,this.getHistoFiltrados()[i],e),t++)}t==0&&this.appSnackBar.openWarningnackBar("Nenhum Arquivo Foi Feito Upload!","OK")})}UploadFile(e,t,i){let s=!1;return new Promise((m,p)=>{this.SimComplementarSrv.uploadSim(t.id,i).subscribe({next:c=>{c.type===H.UploadProgress?(t.status_upload=Math.round(100*c.loaded/c.total).toString()+"%",!s&&this.isCancelando&&(s=!0,this.appSnackBar.openWarningnackBar("Upload Cancelado pelo Usu\xE1rio.","OK"))):c.type===H.Response&&(t.status_upload="Enviado Com Sucesso",m())},error:c=>{this.appSnackBar.openFailureSnackBar(`Erro No UpLoad ${c.error.tabela} - ${c.error.erro} - ${c.error.message}`,"OK"),p(c)}})})}selecionarPasta(){return w(this,null,function*(){let e=yield window.showDirectoryPicker();this.arquivosLocais=[];try{for(var t=I(e.values()),i,s,m;i=!(s=yield t.next()).done;i=!1){let p=s.value;p.kind==="file"&&this.arquivosLocais.push(p)}}catch{m=[s]}finally{try{i&&(s=t.return)&&(yield s.call(t))}finally{if(m)throw m[0]}}return this.setValue(e.name),this.arquivosLocais.length===0?(this.appSnackBar.openFailureSnackBar("A Pasta Selecionada Est\xE1 Vazia.","Fechar"),this.botoesOn=!1):(this.pastaOk=!0,this.botoesOn=!0,this.isCancelando=!1,this.getHistorico(1)),console.log(this.arquivosLocais),{dirHandle:e}})}onClickFiltro(){return this.isFiltroExiste=!this.isFiltroExiste,this.isFiltroExiste}onClickPasta(){if(!this.pastaOk){this.appSnackBar.openFailureSnackBar("Defina Uma Pasta V\xE1lida Para Continuar.","OK");return}return this.filtroPasta?(this.filtroPasta=!1,this.getHistorico(1),this.isFiltroExiste=!1,"Filtrar Pasta"):(this.filtroPasta=!0,this.isFiltroExiste=!1,this.getHistorico(1),"Remover Filtro Pasta")}textoFiltro(){return this.filtroPasta?"Remover Filtro Pasta":"Filtrar Pasta"}textoFiltroExiste(){return this.isFiltroExiste?"Todos":'Existe "SIM"'}inicio(){this.isCancelando=!1,this.isUploading=!1,this.pastaOk=!1,this.arquivosLocais=[],this.historicos=[],this.setValue("")}processado(){this.isUploading=!1,this.pastaOk=!1}getHistoFiltrados(){return this.isFiltroExiste?this.historicos.filter(e=>e.lsArquivos&&e.lsArquivos.arquivos?.length>0):this.historicos}static \u0275fac=function(t){return new(t||o)(g(Q),g(it),g(E),g(K),g(st))};static \u0275cmp=B({type:o,selectors:[["app-upload-sim"]],decls:30,vars:5,consts:[["fileInput",""],[1,"toolbar-alinhada"],[1,"example-spacer"],[1,"button-container"],["mat-raised-button","","color","#FFFFFF",3,"click","disabled"],["mat-raised-button","","color","accent",3,"click"],["autocomplete","off",1,"form-container",3,"formGroup"],[1,"col-med-1"],["appearance","outline",1,"col-max"],["matInput","","formControlName","caminho"],["mat-icon-button","","matSuffix","","matTooltip","Limpar sele\xE7\xE3o",3,"click"],["type","file","hidden","","webkitdirectory","",3,"change"],["class","Browse_Lanc",4,"ngIf"],[1,"Browse_Lanc"],[1,"coluna-cabec"],[4,"ngFor","ngForOf"],[1,"alinha_centro"],[1,"Browse_Lanc_td"],[1,"alinha_direita"],[4,"ngIf"],[3,"opened","closed"],[1,"box"],[1,"alinha_right"]],template:function(t,i){if(t&1){let s=O();a(0,"div",1)(1,"mat-toolbar")(2,"span",2)(3,"mat-label"),n(4,"Upload De Arquivos Do SIM"),r()(),a(5,"div",3)(6,"button",4),_("click",function(){return f(s),h(i.onClickFiltro())}),a(7,"mat-icon"),n(8,"filter"),r(),n(9),r(),a(10,"button",4),_("click",function(){return f(s),h(i.onUpload())}),a(11,"mat-icon"),n(12,"check"),r(),n(13," Upload "),r(),a(14,"button",5),_("click",function(){return f(s),h(i.onCancelar())}),a(15,"mat-icon"),n(16,"cancel"),r(),n(17," Cancelar "),r()()()(),a(18,"form",6)(19,"div",7)(20,"mat-form-field",8)(21,"mat-label"),n(22,'Caminho "Pasta"'),r(),L(23,"input",9),a(24,"button",10),_("click",function(){return f(s),h(i.selecionarPasta())}),a(25,"mat-icon"),n(26,"search"),r()()()(),a(27,"input",11,0),_("change",function(p){return f(s),h(i.onFileSelected(p))}),r()(),v(29,kt,15,1,"table",12)}t&2&&(l(6),d("disabled",!i.botoesOn),l(3),u(" ",i.textoFiltroExiste()," "),l(),d("disabled",!i.botoesOn),l(8),d("formGroup",i.formulario),l(11),d("ngIf",i.getHistoFiltrados().length>0))},dependencies:[D,j,Y,X,Z,J,tt,et,rt,nt,vt,ht,_t,gt,lt,ft,ut,ct,dt,mt,pt,xt],styles:['@charset "UTF-8";.content[_ngcontent-%COMP%]{height:95%;overflow:auto}tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f2f2aa}tr[_ngcontent-%COMP%]:hover{background-color:#caa99d}.form-container[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;margin:20px}.dialog-header[_ngcontent-%COMP%]{display:flex;justify-content:end;align-items:right;padding:1em;border-bottom:1px solid #ccc;background-color:#f5f5f5;position:sticky;top:0;z-index:1}.mat-dialog-container[_ngcontent-%COMP%], .mat-form-field[_ngcontent-%COMP%], .mat-label[_ngcontent-%COMP%], .mat-input-element[_ngcontent-%COMP%], .mat-select-value[_ngcontent-%COMP%], .mat-option[_ngcontent-%COMP%], .mat-error[_ngcontent-%COMP%], .mat-button[_ngcontent-%COMP%], .mat-toolbar[_ngcontent-%COMP%]{font-size:13px}.button-container[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:10px;padding:1em;border-top:1px solid #ccc}.container[_ngcontent-%COMP%]{display:flex;margin-top:3px;margin-bottom:3px;justify-content:flex-start;align-items:center;gap:10px}']})};var wt=[{path:"",redirectTo:"upload-sim",pathMatch:"full"},{path:"upload-sim",component:y}],k=class o{static \u0275fac=function(t){return new(t||o)};static \u0275mod=C({type:o});static \u0275inj=x({imports:[U.forChild(wt),U]})};var Ct=class o{static \u0275fac=function(t){return new(t||o)};static \u0275mod=C({type:o});static \u0275inj=x({imports:[G,k,ot,at,bt,St]})};export{Ct as UploadSimModule};
