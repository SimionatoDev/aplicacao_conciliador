import{a as ue}from"./chunk-APDG2UCO.js";import{c as H,e as $,f as oe}from"./chunk-ZYVY32KO.js";import{B as le,D as pe,E as me,F as ce,R as se,S as de,b as z,e as K,f as Y,g as Z,h as J,i as Q,j as W,k as X,l as ee,o as te,p as ie,s as re,t as ae,u as ne}from"./chunk-Q7QCMHQW.js";import{a as I,b as E,c as L,m as A,o as P}from"./chunk-33ZGYKW3.js";import"./chunk-CARY4E7O.js";import{$b as B,$c as G,Hb as o,Ib as r,Jb as M,Nb as N,Qb as h,Sb as T,Xc as j,Yc as q,_c as D,ac as n,ca as w,cb as l,cc as s,da as b,db as c,ha as U,lc as v,mc as V,na as R,oa as g,oc as y,ub as C,wa as d,xa as u,yb as f}from"./chunk-KCGDNXPD.js";var S=class i{constructor(e){this.http=e}apiURL=H.apiURL;uploadPlanilhaSim(e,t){let a=new FormData;a.append("file",t),a.append("id_empresa",e.toString());let p=new URL("importacaosim/load_sim",this.apiURL).toString(),m=new I("POST",p,a,{reportProgress:!0,responseType:"json"});return this.http.request(m)}uploadPaf(e,t){let a=new FormData;a.append("file",t),a.append("id_empresa",e.toString());let p=new URL("importacaosim/load_sim",this.apiURL).toString(),m=new I("POST",p,a,{reportProgress:!0,responseType:"json"});return this.http.request(m)}static \u0275fac=function(t){return new(t||i)(U(L))};static \u0275prov=w({token:i,factory:i.\u0275fac,providedIn:"root"})};function be(i,e){if(i&1&&(o(0,"tr")(1,"td")(2,"div",18)(3,"mat-label",17),n(4),v(5,"zeroFill"),r()()(),o(6,"td")(7,"div",19)(8,"mat-label",17),n(9),r()()(),o(10,"td")(11,"div",18)(12,"mat-label",17),n(13),r()()(),o(14,"td")(15,"div",20)(16,"mat-label",17),n(17),v(18,"number"),r()()(),M(19,"td"),r()),i&2){let t=e.$implicit,a=e.index;l(4),s("",V(5,4,a+1)," "),l(5),s("",t.arquivo," "),l(4),s("",t.dtRef," "),l(4),s("",y(18,6,t.total,"1.2-2","pt")," ")}}function ge(i,e){if(i&1&&(o(0,"table",13)(1,"tr",14)(2,"th"),n(3,"N\xBA"),r(),o(4,"th"),n(5,"Arquivo"),r(),o(6,"th"),n(7,"Data"),r(),o(8,"th"),n(9,"Total"),r()(),C(10,be,20,10,"tr",15),o(11,"tfoot")(12,"tr")(13,"td",16)(14,"mat-label",17),n(15),v(16,"number"),r()()()()()),i&2){let t=T();l(10),f("ngForOf",t.lsArquivos),l(5),s("Total Geral: ",y(16,2,t.totalGeral,"1.2-2","pt")," ")}}var k=class{constructor(e,t,a){this.arquivo=e;this.dtRef=t;this.total=a}},F=class i{constructor(e,t,a,p,m){this.globalService=e;this.formBuilder=t;this.importacaoSimSrv=a;this.router=p;this.appSnackBar=m;this.formulario=t.group({caminho:[{value:""}]}),this.setValue()}lsArquivos=[];totalGeral=0;selectedFile=null;progress=0;formulario;OnInit(){}onHome(){this.router.navigate([""])}setValue(){this.formulario.setValue({caminho:""})}onFileSelected(e){this.selectedFile=e.target.files[0],this.formulario.patchValue({caminho:this.selectedFile?.name})}onExecucao(){this.onUpload()}onCancelar(){}onUpload(){this.selectedFile&&this.importacaoSimSrv.uploadPlanilhaSim(this.globalService.getEmpresa().id,this.selectedFile).subscribe({next:e=>{if(e.type===E.UploadProgress)this.progress=Math.round(100*e.loaded/e.total);else if(e.type===E.Response){this.progress=0,this.appSnackBar.openSuccessSnackBar("Planilha Importada com Sucesso!","OK");let t=new k(e.body.arquivo,e.body.dtRef,e.body.total);this.totalGeral+=t.total,this.lsArquivos.push(t),this.selectedFile=null,this.formulario.patchValue({caminho:""})}},error:e=>{this.appSnackBar.openFailureSnackBar(`Erro No UpLoad ${e.error.tabela} - ${e.error.erro} - ${e.error.message}`,"OK"),this.progress=0,this.selectedFile=null,this.formulario.patchValue({caminho:""})}})}static \u0275fac=function(t){return new(t||i)(c($),c(W),c(S),c(A),c(oe))};static \u0275cmp=R({type:i,selectors:[["app-upload-file"]],decls:26,vars:3,consts:[["fileInput",""],[1,"toolbar-alinhada"],[1,"example-spacer"],[1,"button-container"],["mat-raised-button","","color","#FFFFFF",3,"click","disabled"],["mat-raised-button","","color","accent",3,"click"],["autocomplete","off",1,"form-container",3,"formGroup"],[1,"col-med-1"],["appearance","outline",1,"col-max"],["matInput","","formControlName","caminho"],["mat-icon-button","","matSuffix","","matTooltip","Limpar sele\xE7\xE3o",1,"clear-buttoncd","abs",3,"click"],["type","file","hidden","","accept",".csv",3,"change"],["class","Browse_Lanc",4,"ngIf"],[1,"Browse_Lanc"],[1,"coluna-cabec"],[4,"ngFor","ngForOf"],["colspan","4",1,"alinha_direita"],[1,"Browse_Lanc_td"],[1,"alinha_centro"],[1,"alinha_esquerda"],[1,"alinha_direita"]],template:function(t,a){if(t&1){let p=N();o(0,"div",1)(1,"mat-toolbar")(2,"span",2)(3,"mat-label"),n(4,"Upload De Planilhas Do SIM"),r()(),o(5,"div",3)(6,"button",4),h("click",function(){return d(p),u(a.onExecucao())}),o(7,"mat-icon"),n(8,"check"),r(),n(9," Upload "),r(),o(10,"button",5),h("click",function(){return d(p),u(a.onHome())}),o(11,"mat-icon"),n(12,"cancel"),r(),n(13," Cancelar "),r()()()(),o(14,"form",6)(15,"div",7)(16,"mat-form-field",8)(17,"mat-label"),n(18,"Arquivo"),r(),M(19,"input",9),o(20,"button",10),h("click",function(x){return d(p),B(24).click(),u(x.stopPropagation())}),o(21,"mat-icon"),n(22,"search"),r()()()(),o(23,"input",11,0),h("change",function(x){return d(p),u(a.onFileSelected(x))}),r()(),C(25,ge,17,6,"table",12)}t&2&&(l(6),f("disabled",!a.selectedFile),l(8),f("formGroup",a.formulario),l(11),f("ngIf",a.lsArquivos.length>0))},dependencies:[j,q,Z,z,K,Y,J,Q,te,ie,re,ce,me,le,pe,ae,ne,D,ue],styles:[".form-container[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;margin:20px}.dialog-header[_ngcontent-%COMP%]{display:flex;justify-content:end;align-items:right;padding:1em;border-bottom:1px solid #ccc;background-color:#f5f5f5;position:sticky;top:0;z-index:1}.mat-dialog-container[_ngcontent-%COMP%], .mat-form-field[_ngcontent-%COMP%], .mat-label[_ngcontent-%COMP%], .mat-input-element[_ngcontent-%COMP%], .mat-select-value[_ngcontent-%COMP%], .mat-option[_ngcontent-%COMP%], .mat-error[_ngcontent-%COMP%], .mat-button[_ngcontent-%COMP%], .mat-toolbar[_ngcontent-%COMP%]{font-size:13px}.button-container[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:10px;padding:1em;border-top:1px solid #ccc}.clear-button[_ngcontent-%COMP%]{margin-top:4px;padding:0;height:24px;width:24px;line-height:24px;vertical-align:middle;transform:translateY(1px)}"]})};var ve=[{path:"",redirectTo:"upload",pathMatch:"full"},{path:"upload",component:F}],_=class i{static \u0275fac=function(t){return new(t||i)};static \u0275mod=g({type:i});static \u0275inj=b({imports:[P.forChild(ve),P]})};var fe=class i{static \u0275fac=function(t){return new(t||i)};static \u0275mod=g({type:i});static \u0275inj=b({imports:[G,_,X,ee,se,de]})};export{fe as UploadFileModule};
