import{a as F}from"./chunk-5NBA5GWV.js";import"./chunk-BYXBJQAS.js";import{a as Et}from"./chunk-U5ZU6LZ4.js";import{c as W,e as Q,f as lt}from"./chunk-XMX2U4D6.js";import{B as ut,D as dt,E as ft,F as _t,G as ht,H as gt,I as St,J as bt,O as vt,R as xt,S as Ct,b as Z,e as J,f as X,g as Y,h as tt,i as et,j as it,k as ot,l as at,n as rt,o as nt,p as st,s as mt,t as pt,u as ct}from"./chunk-BUQZUOJ6.js";import{a as G,b as U,c as z,m as K,o as V}from"./chunk-EHWZVOTM.js";import"./chunk-CARY4E7O.js";import{Ib as o,Jb as a,Kb as O,Ob as E,Rb as h,Tb as S,Yc as D,Zc as j,ad as $,bc as n,ca as A,d as H,da as x,db as l,dc as _,e as T,eb as b,ha as L,mc as B,na as N,nc as R,oa as C,vb as g,wa as d,xa as f,zb as u}from"./chunk-QE3WHX6I.js";var P=class{id_empresa=0;id=0;codemp=0;numpro=0;cod_cli_sim="";datini="";id_contrato=0;status_conciliador="";status_arquivos="";status_assinatura="";pagina=0;tamPagina=50;contador="N";orderby="";sharp=!1};var M=class{index=0;arquivos=[];constructor(e,t){this.index=e,this.arquivos=t}};var q=class{arquivo=null;nome="";constructor(e,t){this.nome=e,this.arquivo=t}};var k=class r{constructor(e){this.http=e}apiURL=W.apiURL;getSim_HistoricosParametro_01Arquivos(e){let t=new URL("importacaosim/sim_historicos_Arquivos",this.apiURL).toString();return this.http.post(t,e)}uploadSim(e,t){console.log("Service - upload Sim-Doc:",t);let i=new FormData;i.append("id_histo",e.toString()),t.forEach(p=>{i.append("files",p)});let s=new URL("importacaosim/load_file_sim",this.apiURL).toString(),m=new G("POST",s,i,{reportProgress:!0,responseType:"json"});return this.http.request(m)}getSim_Historicos_Empresas(){console.log("Service - getSim_Historicos_Empresas",this.apiURL);let e=new URL("sim_historico/complementar/sim_historicos_empresas",this.apiURL).toString();return this.http.post(e,{})}static \u0275fac=function(t){return new(t||r)(L(z))};static \u0275prov=A({token:r,factory:r.\u0275fac,providedIn:"root"})};function qt(r,e){if(r&1&&(o(0,"mat-option",18),n(1),a()),r&2){let t=e.$implicit;u("value",t.codemp),l(),_(" ",t.codemp," ")}}function kt(r,e){if(r&1){let t=E();o(0,"button",19),h("click",function(s){return d(t),S().clearValue("codemp"),f(s.stopPropagation())}),o(1,"mat-icon"),n(2,"clear"),a()()}}function yt(r,e){if(r&1&&(o(0,"tr")(1,"td")(2,"div",29)(3,"mat-label",24),n(4),a()()()()),r&2){let t=e.$implicit;l(4),_("",t.nome," ")}}function wt(r,e){if(r&1&&(o(0,"table",20)(1,"tr",21)(2,"th"),n(3,"Arquivo"),a()(),g(4,yt,5,1,"tr",22),a()),r&2){let t=S(2).$implicit;l(4),u("ngForOf",t.lsArquivos.arquivos)}}function Ht(r,e){if(r&1){let t=E();o(0,"div")(1,"mat-accordion")(2,"mat-expansion-panel",27),h("opened",function(){d(t);let s=S(3);return f(s.panelOpenState=!0)})("closed",function(){d(t);let s=S(3);return f(s.panelOpenState=!1)}),o(3,"mat-expansion-panel-header")(4,"mat-panel-description"),n(5),a()(),o(6,"div",28),g(7,wt,5,1,"table",17),a()()()()}if(r&2){let t=S().$implicit;l(5),_("Total De Arquivos: ",t.lsArquivos.arquivos.length," "),l(2),u("ngIf",t.lsArquivos.arquivos.length>0)}}function Ot(r,e){if(r&1&&(o(0,"tr")(1,"td")(2,"div",23)(3,"mat-label",24),n(4),B(5,"zeroFill"),a()()(),o(6,"td")(7,"div",23)(8,"mat-label",24),n(9),a()()(),o(10,"td")(11,"div",23)(12,"mat-label",24),n(13),a()()(),o(14,"td")(15,"div",25)(16,"mat-label",24),n(17),a()()(),o(18,"td"),g(19,Ht,8,2,"div",26),a(),o(20,"td")(21,"div",23)(22,"mat-label",24),n(23),a()()()()),r&2){let t=e.$implicit,i=e.index;l(4),_("",R(5,6,i+1)," "),l(5),_("",t.codemp," "),l(4),_("",t.tipopro," "),l(4),_("",t.numpro," "),l(2),u("ngIf",t.lsArquivos&&t.lsArquivos.arquivos&&t.lsArquivos.arquivos.length>0),l(4),_("",t.status_upload," ")}}function Ut(r,e){if(r&1&&(o(0,"table",20)(1,"tr",21)(2,"th"),n(3,"Seq"),a(),o(4,"th"),n(5,"Empresa"),a(),o(6,"th"),n(7,"Tipo Proposta"),a(),o(8,"th"),n(9,"N\xBA Proposta"),a(),o(10,"th"),n(11,"Qtd Arquivos"),a(),o(12,"th"),n(13,"Status"),a()(),g(14,Ot,24,8,"tr",22),a()),r&2){let t=S();l(14),u("ngForOf",t.getHistoFiltrados())}}var y=class r{constructor(e,t,i,s,m){this.globalService=e;this.formBuilder=t;this.SimComplementarSrv=i;this.router=s;this.appSnackBar=m;this.formulario=t.group({caminho:[{value:""}],codemp:[{value:""}],pagina:[{value:""}]}),this.setValueNoParams()}arquivos=[];arquivosLocais=[];progress=0;formulario;inscricaoSim;inscricaoEmpresas;controlePaginas=new F(100,0);tamPagina=100;historicos=[];panelOpenState=!1;pastaOk=!1;filtroPasta=!0;isUploading=!1;isCancelando=!1;isFiltroExiste=!1;botoesOn=!1;lsEmpresas=[];ngOnInit(){this.getEmpresas()}ngOnDestroy(){this.inscricaoSim?.unsubscribe()}getEmpresas(){this.inscricaoEmpresas=this.SimComplementarSrv.getSim_Historicos_Empresas().subscribe({next:e=>{console.log("Empresas -> ",e),this.lsEmpresas=e,this.formulario.patchValue({codemp:this.lsEmpresas[0].codemp})},error:e=>{this.lsEmpresas=[]}})}getHistorico(e=2){let t=new P;t.id_empresa=this.globalService.getEmpresa().id,t.codemp=this.formulario.get("codemp")?.value,t.status_arquivos="0",e==1?t.contador="S":(t.tamPagina=this.formulario.get("pagina")?.value,t.pagina=1),this.inscricaoSim=this.SimComplementarSrv.getSim_HistoricosParametro_01Arquivos(t).subscribe({next:i=>{if(e==2){this.historicos=i,console.log(this.historicos);let s=0;this.arquivos=[],this.historicos.forEach(m=>{let p=this.arquivosLocais.filter(v=>{let Pt=`${m.codemp}-${m.numpro}`;return v.name.startsWith(Pt)}),c=[];p.forEach(v=>{c.push(new q(v.name,v))}),m.lsArquivos=new M(s,c),s++})}else this.controlePaginas=new F(this.tamPagina,i.total==0?1:i.total),this.getHistorico()},error:i=>{this.arquivos=[],this.historicos=[],this.controlePaginas=new F(this.tamPagina,0)}})}onHome(){this.router.navigate([""])}setValueNoParams(){this.formulario.setValue({caminho:"",codemp:"",pagina:"10"})}setValue(e=""){this.formulario.patchValue({caminho:e})}onFileSelected(e){let t=e.target.files;if(t.length>0){let m=t[0].webkitRelativePath.split("/")[0];console.log("Pasta selecionada:",m)}}onExecucao(){this.onUpload()}onCancelar(){this.isCancelando=!0,this.isUploading||this.onHome()}onUpload(){return H(this,null,function*(){let e=[],t=0;for(let i=0;i<this.getHistoFiltrados().length;i++)if(this.getHistoFiltrados()[i].lsArquivos?.arquivos.length!=0){e=[];for(let s=0;s<this.getHistoFiltrados()[i].lsArquivos.arquivos.length;s++){let p=yield this.getHistoFiltrados()[i].lsArquivos.arquivos[s].arquivo.getFile();e.push(p)}e.length>0&&(yield this.UploadFile(1,this.getHistoFiltrados()[i],e),t++)}t==0&&this.appSnackBar.openWarningnackBar("Nenhum Arquivo Foi Feito Upload!","OK")})}UploadFile(e,t,i){let s=!1;return new Promise((m,p)=>{this.SimComplementarSrv.uploadSim(t.id,i).subscribe({next:c=>{c.type===U.UploadProgress?(t.status_upload=Math.round(100*c.loaded/c.total).toString()+"%",!s&&this.isCancelando&&(s=!0,this.appSnackBar.openWarningnackBar("Upload Cancelado pelo Usu\xE1rio.","OK"))):c.type===U.Response&&(t.status_upload="Enviado Com Sucesso",m())},error:c=>{this.appSnackBar.openFailureSnackBar(`Erro No UpLoad ${c.error.tabela} - ${c.error.erro} - ${c.error.message}`,"OK"),p(c)}})})}selecionarPasta(){return H(this,null,function*(){let e=yield window.showDirectoryPicker();this.arquivosLocais=[];try{for(var t=T(e.values()),i,s,m;i=!(s=yield t.next()).done;i=!1){let p=s.value;p.kind==="file"&&this.arquivosLocais.push(p)}}catch{m=[s]}finally{try{i&&(s=t.return)&&(yield s.call(t))}finally{if(m)throw m[0]}}return this.setValue(e.name),this.arquivosLocais.length===0?(this.appSnackBar.openFailureSnackBar("A Pasta Selecionada Est\xE1 Vazia.","Fechar"),this.botoesOn=!1):(this.pastaOk=!0,this.botoesOn=!0,this.isCancelando=!1,this.getHistorico(1)),console.log(this.arquivosLocais),{dirHandle:e}})}onClickFiltro(){return this.isFiltroExiste=!this.isFiltroExiste,this.isFiltroExiste}onClickPasta(){if(!this.pastaOk){this.appSnackBar.openFailureSnackBar("Defina Uma Pasta V\xE1lida Para Continuar.","OK");return}return this.filtroPasta?(this.filtroPasta=!1,this.getHistorico(1),this.isFiltroExiste=!1,"Filtrar Pasta"):(this.filtroPasta=!0,this.isFiltroExiste=!1,this.getHistorico(1),"Remover Filtro Pasta")}textoFiltro(){return this.filtroPasta?"Remover Filtro Pasta":"Filtrar Pasta"}textoFiltroExiste(){return this.isFiltroExiste?"Todos":'Existe "SIM"'}inicio(){this.isCancelando=!1,this.isUploading=!1,this.pastaOk=!1,this.arquivosLocais=[],this.historicos=[],this.setValue("")}processado(){this.isUploading=!1,this.pastaOk=!1}getHistoFiltrados(){return this.isFiltroExiste?this.historicos.filter(e=>e.lsArquivos&&e.lsArquivos.arquivos?.length>0):this.historicos}hasValue(e){return this.formulario.get(e)?.value!=""}clearValue(e){e=="codemp"&&this.formulario.patchValue({codemp:""})}static \u0275fac=function(t){return new(t||r)(b(Q),b(it),b(k),b(K),b(lt))};static \u0275cmp=N({type:r,selectors:[["app-upload-sim"]],decls:43,vars:7,consts:[["fileInput",""],[1,"toolbar-alinhada"],[1,"example-spacer"],[1,"button-container"],["mat-raised-button","","color","#FFFFFF",3,"click","disabled"],["mat-raised-button","","color","accent",3,"click"],["autocomplete","off",1,"form-container",3,"formGroup"],[1,"col-med-3"],["appearance","outline",1,"col-max"],["matInput","","formControlName","caminho"],["mat-icon-button","","matSuffix","","matTooltip","Limpar sele\xE7\xE3o",3,"click"],["type","file","hidden","","webkitdirectory","",3,"change"],["appearance","outline",1,"col-max","grupo-select"],["formControlName","codemp"],[3,"value",4,"ngFor","ngForOf"],["mat-icon-button","","matSuffix","","matTooltip","Limpar sele\xE7\xE3o","class","clear-button",3,"click",4,"ngIf"],["matInput","","formControlName","pagina"],["class","Browse_Lanc",4,"ngIf"],[3,"value"],["mat-icon-button","","matSuffix","","matTooltip","Limpar sele\xE7\xE3o",1,"clear-button",3,"click"],[1,"Browse_Lanc"],[1,"coluna-cabec"],[4,"ngFor","ngForOf"],[1,"alinha_centro"],[1,"Browse_Lanc_td"],[1,"alinha_direita"],[4,"ngIf"],[3,"opened","closed"],[1,"box"],[1,"alinha_right"]],template:function(t,i){if(t&1){let s=E();o(0,"div",1)(1,"mat-toolbar")(2,"span",2)(3,"mat-label"),n(4,"Upload De Arquivos Do SIM"),a()(),o(5,"div",3)(6,"button",4),h("click",function(){return d(s),f(i.onClickFiltro())}),o(7,"mat-icon"),n(8,"filter"),a(),n(9),a(),o(10,"button",4),h("click",function(){return d(s),f(i.onUpload())}),o(11,"mat-icon"),n(12,"check"),a(),n(13," Upload "),a(),o(14,"button",5),h("click",function(){return d(s),f(i.onCancelar())}),o(15,"mat-icon"),n(16,"cancel"),a(),n(17," Cancelar "),a()()()(),o(18,"form",6)(19,"div",7)(20,"mat-form-field",8)(21,"mat-label"),n(22,'Caminho "Pasta"'),a(),O(23,"input",9),o(24,"button",10),h("click",function(){return d(s),f(i.selecionarPasta())}),o(25,"mat-icon"),n(26,"search"),a()()(),o(27,"input",11,0),h("change",function(p){return d(s),f(i.onFileSelected(p))}),a(),o(29,"mat-form-field",12)(30,"mat-label"),n(31,"Empresas"),a(),o(32,"mat-select",13),g(33,qt,2,2,"mat-option",14),a(),g(34,kt,3,0,"button",15),a(),o(35,"mat-form-field",8)(36,"mat-label"),n(37,"Tamanho da P\xE1gina"),a(),O(38,"input",16),o(39,"button",10),h("click",function(p){return d(s),i.clearValue("pagina"),f(p.stopPropagation())}),o(40,"mat-icon"),n(41,"clear"),a()()()()(),g(42,Ut,15,1,"table",17)}t&2&&(l(6),u("disabled",!i.botoesOn),l(3),_(" ",i.textoFiltroExiste()," "),l(),u("disabled",!i.botoesOn),l(8),u("formGroup",i.formulario),l(15),u("ngForOf",i.lsEmpresas),l(),u("ngIf",i.hasValue("codemp")),l(8),u("ngIf",i.getHistoFiltrados().length>0))},dependencies:[D,j,Y,Z,J,X,tt,et,rt,nt,st,bt,ht,gt,St,mt,_t,ft,ut,dt,vt,pt,ct,Et],styles:['@charset "UTF-8";.content[_ngcontent-%COMP%]{height:95%;overflow:auto}tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f2f2aa}tr[_ngcontent-%COMP%]:hover{background-color:#caa99d}.form-container[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;margin:20px}.dialog-header[_ngcontent-%COMP%]{display:flex;justify-content:end;align-items:right;padding:1em;border-bottom:1px solid #ccc;background-color:#f5f5f5;position:sticky;top:0;z-index:1}.mat-dialog-container[_ngcontent-%COMP%], .mat-form-field[_ngcontent-%COMP%], .mat-label[_ngcontent-%COMP%], .mat-input-element[_ngcontent-%COMP%], .mat-select-value[_ngcontent-%COMP%], .mat-option[_ngcontent-%COMP%], .mat-error[_ngcontent-%COMP%], .mat-button[_ngcontent-%COMP%], .mat-toolbar[_ngcontent-%COMP%]{font-size:13px}.button-container[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:10px;padding:1em;border-top:1px solid #ccc}.container[_ngcontent-%COMP%]{display:flex;margin-top:3px;margin-bottom:3px;justify-content:flex-start;align-items:center;gap:10px}']})};var Vt=[{path:"",redirectTo:"upload-sim",pathMatch:"full"},{path:"upload-sim",component:y}],w=class r{static \u0275fac=function(t){return new(t||r)};static \u0275mod=C({type:r});static \u0275inj=x({imports:[V.forChild(Vt),V]})};var Ft=class r{static \u0275fac=function(t){return new(t||r)};static \u0275mod=C({type:r});static \u0275inj=x({imports:[$,w,ot,at,xt,Ct]})};export{Ft as UploadSimModule};
